{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"ins-container\">\r\n\t\t<view class=\"ins-header\">\r\n\t\t\t<text class=\"ins-title\">HI WINE 酒馆</text>\r\n\t\t\t<text class=\"ins-sub\">INS风格酒水体验馆</text>\r\n\t\t</view>\r\n\t\t<view class=\"ins-tabs\">\r\n\t\t\t<view\r\n\t\t\t\tv-for=\"(cat, idx) in categories\"\r\n\t\t\t\t:key=\"cat.id || idx\"\r\n\t\t\t\t:class=\"['ins-tab', idx === activeTab ? 'active' : '']\"\r\n\t\t\t\t@tap=\"changeCategory(idx)\"\r\n\t\t\t>\r\n\t\t\t\t{{ idx === 0 ? '全部' : cat.name }}\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"ins-list\">\r\n\t\t\t<view v-for=\"item in wines\" :key=\"item.id\" class=\"ins-card\">\r\n\t\t\t\t<image :src=\"item.image ? item.image : IMG_BASE_URL + '/wine.png'\" class=\"ins-img\" mode=\"aspectFill\" lazy-load=\"true\" :style=\"{background:'#f3f3f3'}\" />\r\n\t\t\t\t<view class=\"ins-info\">\r\n\t\t\t\t\t<text class=\"ins-name\">{{ item.name }}</text>\r\n\t\t\t\t\t<text class=\"ins-price\">￥{{ item.price }}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<button class=\"ins-btn\" @tap=\"addToCart(item)\">加入购物车</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view v-if=\"loading\" class=\"loading\">加载中...</view>\r\n\t\t<view v-if=\"!loading && wines.length === 0\" class=\"empty\">暂无商品</view>\r\n\t\t\r\n\t\t<!-- 调试信息 -->\r\n\t\t<view v-if=\"debugInfo\" class=\"debug-info\">\r\n\t\t\t<text>分类数量: {{ categories.length }}</text>\r\n\t\t\t<text>商品数量: {{ wines.length }}</text>\r\n\t\t\t<text>接口状态: {{ debugInfo }}</text>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport { IMG_BASE_URL } from '@/config.js';\r\nimport api from '@/utils/api.js';\r\n\r\nfunction debounce(fn, delay) {\r\n\tlet timer = null;\r\n\treturn function(...args) {\r\n\t\tif (timer) clearTimeout(timer);\r\n\t\ttimer = setTimeout(() => fn.apply(this, args), delay);\r\n\t};\r\n}\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tcategories: [{ name: '全部' }],\r\n\t\t\tactiveTab: 0,\r\n\t\t\twines: [],\r\n\t\t\tloading: false,\r\n\t\t\tpage: 1,\r\n\t\t\tsize: 10,\r\n\t\t\thasMore: true,\r\n\t\t\tIMG_BASE_URL,\r\n\t\t\tdebugInfo: ''\r\n\t\t}\r\n\t},\r\n\tonLoad() {\r\n\t\tthis.loadCategories();\r\n\t\tthis.loadProducts();\r\n\t},\r\n\tmethods: {\r\n\t\t// 加载商品分类\r\n\t\tasync loadCategories() {\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await api.getCategoryList();\r\n\t\t\t\tconsole.log('分类响应数据:', JSON.stringify(res));\r\n\t\t\t\tif (res && res.data && res.data.list) {\r\n\t\t\t\t\t// 添加\"全部\"分类\r\n\t\t\t\t\tthis.categories = [{ name: '全部' }, ...res.data.list];\r\n\t\t\t\t\tthis.debugInfo = '分类加载成功';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.debugInfo = '分类数据格式不正确: ' + JSON.stringify(res);\r\n\t\t\t\t}\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error('加载分类失败', err);\r\n\t\t\t\tthis.debugInfo = '分类加载失败: ' + err.message;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 切换分类\r\n\t\tchangeCategory(index) {\r\n\t\t\tif (this.activeTab === index) return;\r\n\t\t\tthis.activeTab = index;\r\n\t\t\tthis.wines = [];\r\n\t\t\tthis.page = 1;\r\n\t\t\tthis.hasMore = true;\r\n\t\t\tthis.loadProducts();\r\n\t\t},\r\n\t\t\r\n\t\t// 加载商品列表\r\n\t\tasync loadProducts() {\r\n\t\t\tif (this.loading || !this.hasMore) return;\r\n\t\t\t\r\n\t\t\tthis.loading = true;\r\n\t\t\ttry {\r\n\t\t\t\tconst categoryId = this.activeTab === 0 ? 0 : this.categories[this.activeTab].id;\r\n\t\t\t\tconsole.log('请求商品列表，分类ID:', categoryId);\r\n\t\t\t\tconst res = await api.getProductList(categoryId, '', this.page, this.size);\r\n\t\t\t\tconsole.log('商品列表响应:', JSON.stringify(res));\r\n\t\t\t\t\r\n\t\t\t\tif (res && res.data && res.data.list) {\r\n\t\t\t\t\t// 如果是第一页，直接替换数据，否则追加数据\r\n\t\t\t\t\tif (this.page === 1) {\r\n\t\t\t\t\t\tthis.wines = res.data.list;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.wines = [...this.wines, ...res.data.list];\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\t// 判断是否还有更多数据\r\n\t\t\t\t\tthis.hasMore = res.data.list.length === this.size;\r\n\t\t\t\t\tthis.page++;\r\n\t\t\t\t\tthis.debugInfo = '商品加载成功，共' + this.wines.length + '条';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.debugInfo = '商品数据格式不正确: ' + JSON.stringify(res);\r\n\t\t\t\t}\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error('加载商品失败', err);\r\n\t\t\t\tthis.debugInfo = '商品加载失败: ' + err.message;\r\n\t\t\t\tuni.showToast({\r\n\t\t\t\t\ttitle: '加载商品失败',\r\n\t\t\t\t\ticon: 'none'\r\n\t\t\t\t});\r\n\t\t\t} finally {\r\n\t\t\t\tthis.loading = false;\r\n\t\t\t}\r\n\t\t},\r\n\t\t\r\n\t\t// 添加到购物车\r\n\t\taddToCart: debounce(function(item) {\r\n\t\t\tlet cart = uni.getStorageSync('cart') || [];\r\n\t\t\tconst idx = cart.findIndex(i => i.id === item.id);\r\n\t\t\tlet changed = false;\r\n\t\t\t\r\n\t\t\tif (idx !== -1) {\r\n\t\t\t\tcart[idx].count += 1;\r\n\t\t\t\tchanged = true;\r\n\t\t\t} else {\r\n\t\t\t\t// 转换API返回的商品格式为购物车格式\r\n\t\t\t\tcart.push({\r\n\t\t\t\t\tid: item.id,\r\n\t\t\t\t\tname: item.name,\r\n\t\t\t\t\tprice: item.price,\r\n\t\t\t\t\timage: item.image,\r\n\t\t\t\t\tcount: 1\r\n\t\t\t\t});\r\n\t\t\t\tchanged = true;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (changed) {\r\n\t\t\t\tuni.setStorageSync('cart', cart);\r\n\t\t\t\tuni.showToast({ title: `已加入购物车`, icon: 'success' });\r\n\t\t\t}\r\n\t\t}, 300),\r\n\t},\r\n\t// 下拉刷新\r\n\tonPullDownRefresh() {\r\n\t\tthis.wines = [];\r\n\t\tthis.page = 1;\r\n\t\tthis.hasMore = true;\r\n\t\tthis.loadProducts().then(() => {\r\n\t\t\tuni.stopPullDownRefresh();\r\n\t\t});\r\n\t},\r\n\t// 上拉加载更多\r\n\tonReachBottom() {\r\n\t\tthis.loadProducts();\r\n\t}\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n\t.ins-container {\r\n\t\tmin-height: 100vh;\r\n\t\tbackground: #f8f6f4;\r\n\t\tpadding-bottom: 40rpx;\r\n\t}\r\n\t.ins-header {\r\n\t\tpadding: 60rpx 0 10rpx 0;\r\n\t\ttext-align: center;\r\n\t}\r\n\t.ins-title {\r\n\t\tfont-size: 52rpx;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #222;\r\n\t\tletter-spacing: 2rpx;\r\n\t\tfont-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;\r\n\t}\r\n\t.ins-sub {\r\n\t\tfont-size: 28rpx;\r\n\t\tcolor: #b8b8b8;\r\n\t\tmargin-top: 10rpx;\r\n\t\tletter-spacing: 1rpx;\r\n\t}\r\n\t.ins-tabs {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t\tmargin: 30rpx 0 40rpx 0;\r\n\t\tgap: 30rpx;\r\n\t\tflex-wrap: wrap;\r\n\t\tpadding: 0 20rpx;\r\n\t}\r\n\t.ins-tab {\r\n\t\tfont-size: 30rpx;\r\n\t\tcolor: #b8b8b8;\r\n\t\tpadding: 12rpx 38rpx;\r\n\t\tborder-radius: 32rpx;\r\n\t\tbackground: linear-gradient(90deg, #fff 60%, #f8f6f4 100%);\r\n\t\ttransition: all 0.2s;\r\n\t\tbox-shadow: 0 2rpx 8rpx #f3f3f3;\r\n\t\tfont-weight: 500;\r\n\t\tmargin-bottom: 10rpx;\r\n\t}\r\n\t.ins-tab.active {\r\n\t\tcolor: #fff;\r\n\t\tbackground: linear-gradient(90deg, #f7cac9 0%, #92a8d1 100%);\r\n\t\tfont-weight: bold;\r\n\t\tbox-shadow: 0 4rpx 16rpx #e0e0e0;\r\n\t\ttransform: scale(1.08);\r\n\t\tletter-spacing: 2rpx;\r\n\t}\r\n\t.ins-list {\r\n\t\tdisplay: flex;\r\n\t\tflex-wrap: wrap;\r\n\t\tjustify-content: center;\r\n\t\tgap: 40rpx 32rpx;\r\n\t\tpadding: 0 24rpx;\r\n\t}\r\n\t.ins-card {\r\n\t\twidth: 340rpx;\r\n\t\tbackground: #fff;\r\n\t\tborder-radius: 36rpx;\r\n\t\tbox-shadow: 0 8rpx 32rpx #eaeaea;\r\n\t\toverflow: hidden;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 24rpx;\r\n\t\tmin-height: 420rpx;\r\n\t\tpadding-bottom: 24rpx;\r\n\t}\r\n\t.ins-img {\r\n\t\twidth: 100%;\r\n\t\theight: 220rpx;\r\n\t\tobject-fit: cover;\r\n\t\tborder-top-left-radius: 36rpx;\r\n\t\tborder-top-right-radius: 36rpx;\r\n\t\tbackground: #f3f3f3;\r\n\t}\r\n\t.ins-info {\r\n\t\twidth: 100%;\r\n\t\tpadding: 20rpx 24rpx 0 24rpx;\r\n\t\tflex: 1;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: flex-start;\r\n\t\tjustify-content: flex-start;\r\n\t}\r\n\t.ins-name {\r\n\t\tfont-size: 34rpx;\r\n\t\tcolor: #222;\r\n\t\tfont-weight: 600;\r\n\t\tmargin-bottom: 10rpx;\r\n\t\tline-height: 1.4;\r\n\t\tmax-width: 100%;\r\n\t\theight: 96rpx;\r\n\t\toverflow: hidden;\r\n\t\ttext-overflow: ellipsis;\r\n\t\tdisplay: -webkit-box;\r\n\t\t-webkit-line-clamp: 2;\r\n\t\t-webkit-box-orient: vertical;\r\n\t}\r\n\t.ins-price {\r\n\t\tfont-size: 32rpx;\r\n\t\tcolor: #f7cac9;\r\n\t\tfont-weight: bold;\r\n\t}\r\n\t.ins-btn {\r\n\t\twidth: 85%;\r\n\t\theight: 80rpx;\r\n\t\tline-height: 80rpx;\r\n\t\tbackground: linear-gradient(90deg, #f7cac9 0%, #92a8d1 100%);\r\n\t\tcolor: #fff;\r\n\t\tborder-radius: 40rpx;\r\n\t\tfont-size: 30rpx;\r\n\t\tfont-weight: bold;\r\n\t\tmargin-top: 10rpx;\r\n\t\tborder: none;\r\n\t\tposition: relative;\r\n\t\toverflow: hidden;\r\n\t}\r\n\t.ins-btn::after {\r\n\t\tcontent: '';\r\n\t\tposition: absolute;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\tbackground: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0.1) 100%);\r\n\t\topacity: 0;\r\n\t\ttransition: opacity 0.3s;\r\n\t}\r\n\t.ins-btn:active::after {\r\n\t\topacity: 1;\r\n\t}\r\n\t.loading {\r\n\t\ttext-align: center;\r\n\t\tpadding: 30rpx 0;\r\n\t\tcolor: #b8b8b8;\r\n\t\tfont-size: 28rpx;\r\n\t}\r\n\t.empty {\r\n\t\ttext-align: center;\r\n\t\tpadding: 60rpx 0;\r\n\t\tcolor: #999;\r\n\t\tfont-size: 30rpx;\r\n\t}\r\n\t.debug-info {\r\n\t\tpadding: 20rpx;\r\n\t\tbackground-color: rgba(0,0,0,0.05);\r\n\t\tmargin: 20rpx;\r\n\t\tborder-radius: 10rpx;\r\n\t\tfont-size: 24rpx;\r\n\t\tcolor: #666;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'D:/code/WeChatProjects/hi-wine/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["IMG_BASE_URL","api","uni"],"mappings":"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"}