{"version":3,"file":"index.js","sources":["pages/cart/index.vue","../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2FydC9pbmRleC52dWU"],"sourcesContent":["<template>\r\n  <view class=\"cart-container\">\r\n    <view class=\"cart-header\">购物车</view>\r\n    <view v-if=\"cart.length === 0\" class=\"cart-empty\">购物车空空如也~</view>\r\n    <view v-else class=\"cart-list\">\r\n      <view v-for=\"item in cart\" :key=\"item.id\" class=\"cart-item\">\r\n        <image :src=\"item.image ? item.image : IMG_BASE_URL + '/wine.png'\" class=\"cart-img\" mode=\"aspectFill\" />\r\n        <view class=\"cart-info\">\r\n          <text class=\"cart-name\">{{ item.name }}</text>\r\n          <text class=\"cart-price\">￥{{ item.price }}</text>\r\n          <view class=\"cart-ctrl\">\r\n            <button class=\"cart-btn\" @tap=\"changeCount(item, -1)\" :disabled=\"item.count<=1\">-</button>\r\n            <text class=\"cart-count\">{{ item.count }}</text>\r\n            <button class=\"cart-btn\" @tap=\"changeCount(item, 1)\">+</button>\r\n            <button class=\"cart-del\" @tap=\"removeItem(item)\">删除</button>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <view class=\"cart-footer\">\r\n        <text>合计：</text>\r\n        <text class=\"cart-total\">￥{{ totalPrice }}</text>\r\n        <button class=\"cart-order\" @tap=\"showOrderConfirm\">下单</button>\r\n      </view>\r\n    </view>\r\n    \r\n    <!-- 加载中 -->\r\n    <uni-popup ref=\"loading\" type=\"dialog\" :mask-click=\"false\">\r\n      <uni-popup-dialog\r\n        title=\"处理中\"\r\n        content=\"订单提交中，请稍候...\"\r\n        :show-cancel=\"false\"\r\n        :before-close=\"true\"\r\n      ></uni-popup-dialog>\r\n    </uni-popup>\r\n\r\n    <picker :range=\"tableList\" range-key=\"name\" @change=\"onTableChange\">\r\n      <view class=\"picker\">请选择桌台：{{ selectedTableId ? (tableList.find(t => t.id === selectedTableId)?.name || '') : '未选择' }}</view>\r\n    </picker>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { IMG_BASE_URL } from '@/config.js';\r\nimport api from '@/utils/api.js';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      cart: [],\r\n      tableList: [],\r\n      selectedTableId: null,\r\n      IMG_BASE_URL,\r\n      submitting: false\r\n    };\r\n  },\r\n  computed: {\r\n    totalPrice() {\r\n      return this.cart.reduce((sum, item) => sum + item.price * item.count, 0);\r\n    },\r\n  },\r\n  onShow() {\r\n    // 每次显示页面时，从本地存储读取购物车数据\r\n    this.loadCartData();\r\n  },\r\n  onLoad() {\r\n    this.fetchTableList();\r\n  },\r\n  methods: {\r\n    async fetchTableList() {\r\n      const res = await uni.request({ url: 'http://你的后端地址/api/table/list' });\r\n      if (res.data.code === 0) {\r\n        this.tableList = res.data.data || [];\r\n      }\r\n    },\r\n    onTableChange(e) {\r\n      this.selectedTableId = this.tableList[e.detail.value].id;\r\n    },\r\n    // 加载购物车数据\r\n    loadCartData() {\r\n      const cartData = uni.getStorageSync('cart') || [];\r\n      this.cart = cartData;\r\n    },\r\n    \r\n    // 修改商品数量\r\n    changeCount(item, delta) {\r\n      const idx = this.cart.findIndex(i => i.id === item.id);\r\n      if (idx !== -1) {\r\n        this.cart[idx].count += delta;\r\n        if (this.cart[idx].count < 1) this.cart[idx].count = 1;\r\n        this.updateCartStorage();\r\n      }\r\n    },\r\n    \r\n    // 移除商品\r\n    removeItem(item) {\r\n      this.cart = this.cart.filter(i => i.id !== item.id);\r\n      this.updateCartStorage();\r\n    },\r\n    \r\n    // 更新本地存储\r\n    updateCartStorage() {\r\n      uni.setStorageSync('cart', this.cart);\r\n    },\r\n    \r\n    // 显示下单确认弹窗\r\n    showOrderConfirm() {\r\n      if (this.cart.length === 0) {\r\n        uni.showToast({\r\n          title: '购物车为空',\r\n          icon: 'none'\r\n        });\r\n        return;\r\n      }\r\n      \r\n      // 检查是否登录\r\n      const token = uni.getStorageSync('token');\r\n      if (!token) {\r\n        uni.showToast({\r\n          title: '请先登录',\r\n          icon: 'none'\r\n        });\r\n        setTimeout(() => {\r\n          uni.switchTab({\r\n            url: '/pages/profile/index'\r\n          });\r\n        }, 1500);\r\n        return;\r\n      }\r\n      \r\n      uni.showModal({\r\n        title: '确认下单',\r\n        content: '确定要提交订单吗？',\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            this.submitOrder();\r\n          }\r\n        }\r\n      });\r\n    },\r\n    \r\n    // 提交订单\r\n    async submitOrder() {\r\n      if (this.cart.length === 0) {\r\n        uni.showToast({ title: '购物车为空', icon: 'none' });\r\n        return;\r\n      }\r\n      this.submitting = true;\r\n      uni.showLoading({ title: '订单提交中...', mask: true });\r\n      try {\r\n        const items = this.cart.map(item => ({\r\n          productId: item.id,\r\n          quantity: item.count\r\n        }));\r\n        const res = await api.createOrder(this.selectedTableId || 0, items);\r\n        if (res && res.code === 0 && res.data && res.data.id) {\r\n          this.cart = [];\r\n          this.updateCartStorage();\r\n          uni.hideLoading();\r\n          uni.showToast({ title: '下单成功', icon: 'success' });\r\n          setTimeout(() => {\r\n            uni.switchTab({ url: '/pages/order/index' });\r\n          }, 1500);\r\n        } else {\r\n          throw new Error('创建订单失败');\r\n        }\r\n      } catch (err) {\r\n        uni.showToast({ title: '下单失败，请重试', icon: 'none' });\r\n      } finally {\r\n        this.submitting = false;\r\n        uni.hideLoading();\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.cart-container {\r\n  min-height: 100vh;\r\n  background: #f8f6f4;\r\n  padding-bottom: 40rpx;\r\n}\r\n.cart-header {\r\n  padding: 60rpx 0 20rpx 0;\r\n  text-align: center;\r\n  font-size: 48rpx;\r\n  font-weight: bold;\r\n  color: #222;\r\n  letter-spacing: 2rpx;\r\n}\r\n.cart-empty {\r\n  text-align: center;\r\n  color: #b8b8b8;\r\n  margin-top: 120rpx;\r\n  font-size: 32rpx;\r\n}\r\n.cart-list {\r\n  padding: 0 24rpx;\r\n}\r\n.cart-item {\r\n  display: flex;\r\n  background: #fff;\r\n  border-radius: 32rpx;\r\n  box-shadow: 0 4rpx 24rpx #eaeaea;\r\n  margin-bottom: 24rpx;\r\n  overflow: hidden;\r\n}\r\n.cart-img {\r\n  width: 180rpx;\r\n  height: 140rpx;\r\n  object-fit: cover;\r\n  border-top-left-radius: 32rpx;\r\n  border-bottom-left-radius: 32rpx;\r\n}\r\n.cart-info {\r\n  flex: 1;\r\n  padding: 20rpx 24rpx 0 24rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n}\r\n.cart-name {\r\n  font-size: 32rpx;\r\n  color: #222;\r\n  font-weight: 500;\r\n}\r\n.cart-price {\r\n  font-size: 28rpx;\r\n  color: #f7cac9;\r\n  font-weight: bold;\r\n  margin-bottom: 8rpx;\r\n}\r\n.cart-ctrl {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 12rpx;\r\n  margin-bottom: 12rpx;\r\n}\r\n.cart-btn {\r\n  width: 48rpx;\r\n  height: 48rpx;\r\n  border-radius: 50%;\r\n  background: #f7cac9;\r\n  color: #fff;\r\n  border: none;\r\n  font-size: 32rpx;\r\n  font-weight: bold;\r\n  line-height: 48rpx;\r\n  text-align: center;\r\n}\r\n.cart-del {\r\n  background: #eee;\r\n  color: #b8b8b8;\r\n  border: none;\r\n  border-radius: 24rpx;\r\n  font-size: 24rpx;\r\n  padding: 0 16rpx;\r\n  margin-left: 10rpx;\r\n}\r\n.cart-footer {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: flex-end;\r\n  gap: 24rpx;\r\n  margin-top: 30rpx;\r\n}\r\n.cart-total {\r\n  font-size: 36rpx;\r\n  color: #f7cac9;\r\n  font-weight: bold;\r\n}\r\n.cart-order {\r\n  background: linear-gradient(90deg, #f7cac9 0%, #92a8d1 100%);\r\n  color: #fff;\r\n  border: none;\r\n  border-radius: 24rpx;\r\n  font-size: 28rpx;\r\n  font-weight: 500;\r\n  padding: 8rpx 36rpx;\r\n  box-shadow: 0 2rpx 8rpx #e0e0e0;\r\n}\r\n</style> ","import MiniProgramPage from 'D:/code/WeChatProjects/hi-wine/pages/cart/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["IMG_BASE_URL","uni","api"],"mappings":"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"}